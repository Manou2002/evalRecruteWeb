<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Offres</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <button type="button" class="btn btn-sm btn-primary" (click)="open(template)">
      <span data-feather="calendar" class="align-text-bottom"></span>
      Ajouter un Offre
    </button>
  </div>
</div>

<h2>Liste des Offres</h2>
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Titre</th>
        <th scope="col">Mission</th>
        <th scope="col">Competence</th>
        <th scope="col">DateOffre</th>
        <th scope="col">DateExpiration</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr scope="row" *ngFor="let Offre of OffreList; index as i">
        <td>{{i+1}}</td>
        <td>{{Offre.titre}}</td>
        <td>{{Offre.mission}}</td>
        <td>{{Offre.competence}}</td>
        <td>{{Offre.dateOffre}}</td>
        <td>{{Offre.dateExpiration}}</td>

        <td>
          <button type="button" class="btn btn-warning" (click)="open(template, Offre)"><i class="fa fa-edit"></i></button>&nbsp;
          <button type="button"  class="btn btn-danger" (click)="open(templateDelete, Offre, true)"><i class="fa fa-trash"></i></button>
        </td>
      </tr>
    </tbody>
  </table>
  <nav aria-label="...">
    <ul class="pagination justify-content-center">
      <a class="page-link {{apiResponse?.total_pages == 1 ? 'disabled' : '' }}" href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
      <div *ngIf="page_size">
        <li *ngFor="let item of page_array; let index = index" class="page-item  {{apiResponse?.current_page == index ? 'active' : ''}}" attr.aria-current="{{apiResponse?.current_page == index ? 'page' : ''}}">
          <a *ngIf="apiResponse?.current_page != index" class="page-link" href="#"> {{index + 1}} </a>
          <span class="page-link" *ngIf="apiResponse?.current_page == index">{{index + 1}} </span>
        </li>
      </div>
      
      <a class="page-link {{apiResponse?.total_pages == 1 ? 'disabled' : '' }}" href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </ul>
  </nav>
</div>

<ng-template #template let-modal>
<div class="modal-lg">
  <div class="modal-content">
  <div class="modal-header">
    <h4 class="modal-title pull-left">Ajout d'un Offre</h4>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>

  <form  #addOffreForm="ngForm" (ngSubmit)="save(addOffreForm)">
  <div class="modal-body">
    <div class="row">
      <div class="col-md-12 col-sm-12">
        <div class="mb-3">
          <label for="titre" class="form-label">Titre</label>
          <input type="text" id="titre" name="titre" required [(ngModel)]="OffreForm.titre" #titre="ngModel" class="form-control" placeholder="veuillez renseigner le titre du Offre" aria-describedby="passwordHelpBlock">
          <div [hidden]="titre.valid || titre.pristine" class="alert alert-danger">
            Ce champs est obligatoire
          </div>
        </div>
      </div>
      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="mission" class="form-label">Mission</label>
          <textarea  id="mission" rows="3" name="mission" required [(ngModel)]="OffreForm.mission" #mission="ngModel" class="form-control" placeholder="veuillez renseigner la mission de l'offre" aria-describedby="passwordHelpBlock"></textarea>
          <div [hidden]="mission.valid || mission.pristine" class="alert alert-danger">
            Ce champs est obligatoire
          </div>
        </div> 
      </div>
      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="competence" class="form-label">Competences</label>
          <textarea name="competence" id="competence" rows="3" required [(ngModel)]="OffreForm.competence" #competence="ngModel" class="form-control" placeholder="veuillez renseigner la competence requise de l'offre" aria-describedby="passwordHelpBlock" ></textarea>
          <div [hidden]="mission.valid || mission.pristine" class="alert alert-danger">
            Ce champs est obligatoire
          </div>
        </div>   
      </div>

      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="dateExpiration" class="form-label">Date d'expiration</label>
          <input type="date" id="dateExpiration" name="dateExpiration" required [(ngModel)]="OffreForm.dateExpiration" #dateExpiration="ngModel" class="form-control" aria-describedby="passwordHelpBlock">
          <div [hidden]="dateExpiration.valid || dateExpiration.pristine" class="alert alert-danger">
            Ce champs est obligatoire
          </div>
        </div>  
      </div>
      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="nombreOffre" class="form-label">Nombre de Offre</label>
          <input type="number" min="1" id="nombreOffre" name="nombreOffre"  required [(ngModel)]="OffreForm.nombreOffre" #nombreOffre="ngModel" class="form-control" aria-describedby="passwordHelpBlock">
      </div> 
      </div>

      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="inputPassword5" class="form-label">Domaine d'activité</label>
          <select class="form-select" id="domainActivite" name="domainActivite" required [(ngModel)]="OffreForm.domaineActivite.id" #domaineActivite="ngModel" class="form-control" aria-label="Default select example">
            <option value="0">Sélectionnez le domaine d'activité</option>
            <option *ngFor="let domaineActiviteData of domainActiviteList" 
            value="{{domaineActiviteData.id}}">{{domaineActiviteData.libelle}}</option>
          </select>
          <div [hidden]="!controlSelection(domaineActivite) || domaineActivite.pristine"
                  class="alert alert-danger">
                  Ce champ est obligatoire
              </div>
      </div> 
      </div>

      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="inputPassword5" class="form-label">Niveau d'expérience</label>
          <select class="form-select"  id="niveauExperience" name="niveauExperience" required [(ngModel)]="OffreForm.niveauExperience.id" #niveauExperience="ngModel" aria-label="Default select example">
            <option value="0">Sélectionnez un niveau d'expérience</option>
            <option *ngFor="let niveauExperienceData of niveauExperienceList" 
            value="{{niveauExperienceData.id}}">{{niveauExperienceData.libelle}}</option>
          </select>
          <div [hidden]="!controlSelection(niveauExperience) || niveauExperience.pristine"
          class="alert alert-danger">
          Ce champ est obligatoire
          </div>
      </div> 
      </div>

      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="inputPassword5" class="form-label">Niveau d'étude</label>
          <select class="form-select" id="niveauEtude" name="niveauEtude" required [(ngModel)]="OffreForm.niveauEtude.id" #niveauEtude="ngModel" aria-label="Default select example">
            <option value="0">Sélectionnez un niveau d'étude</option>
            <option *ngFor="let niveauEtudeData of niveauEtudeList" 
            value="{{niveauEtudeData.id}}">{{niveauEtudeData.libelle}}</option>
          </select>
          <div [hidden]="!controlSelection(niveauEtude) || niveauEtude.pristine"
          class="alert alert-danger">
          Ce champ est obligatoire
          </div>
      </div> 
      </div>

      <div class="col-md-6 col-sm-12">
        <div class="mb-3">
          <label for="inputPassword5" class="form-label">Type de contrat</label>
          <select class="form-select"  id="typeContrat" name="typeContrat" required [(ngModel)]="OffreForm.TypesContrats.id" #typeContrat="ngModel"  aria-label="Default select example">
            <option selected>Sélectionnez un type de contrat</option>
            <option *ngFor="let typeContratData of typeContratList"
            value="{{typeContratData.id}}">{{typeContratData.libelle}}</option>
          </select>
          <div [hidden]="!controlSelection(typeContrat) || typeContrat.pristine"
          class="alert alert-danger">
          Ce champ est obligatoire
          </div>
      </div> 
      </div>

    </div>

  </div>
  <div class="modal-footer">
      <button class="btn btn-success" type="submit">Valider</button>
  </div>
</form>
</div>
</div>
</ng-template>
<ng-template #templateDelete let-modal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{txtModalHeader}}</h4>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
          <p class="fs-5">Voulez-vous supprimer ce niveau d'etude ?</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.dismiss('Cross click')">
      Annuler
    </button>
      <button class="btn btn-success" type="submit" (click)="delete()">
        <i class="fa" [ngClass]="{'fa-spin fa-spinner' : loadingBtn, 'fa-check': !loadingBtn}"></i>
        {{textButton}}
      </button>
  </div> 
</ng-template> 
